<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="attendanceMapper">
	
	<insert id="insertInTime">
		INSERT INTO WORK(NO, EMP_NO, IN_TIME) VALUES(SEQ_WORK.NEXTVAL, #{empNo}, SYSDATE)
	</insert>
	
	<update id="updateOutTime">
		UPDATE WORK SET OUT_TIME = SYSDATE WHERE EMP_NO = #{empNo} AND NO = #{no} AND OUT_TIME IS NULL
	</update>
	
	<select id="selectInOutTime" resultType="WorkTimeVo">
		SELECT NO, EMP_NO, NVL(TO_CHAR(IN_TIME, 'HH24:MI'), '미등록') AS IN_TIME, NVL(TO_CHAR(OUT_TIME, 'HH24:MI'), '미등록') AS OUT_TIME FROM WORK WHERE EMP_NO = #{empNo} AND TO_CHAR(IN_TIME, 'YYYY/MM/DD') = TO_CHAR(SYSDATE, 'YYYY/MM/DD')
	</select>
	
	<select id="selectMonthWork" resultType="int">
		SELECT NVL(SUM(TRUNC((OUT_TIME - IN_TIME) * 24 * 60)), 0) AS MONTH_WORK FROM WORK WHERE EMP_NO = #{empNo} AND TO_CHAR(IN_TIME, 'YYYY/MM') = TO_CHAR(SYSDATE, 'YYYY/MM')
	</select>
	
	<select id="selectWeekWork" resultType="int">
		SELECT NVL(SUM(TRUNC((OUT_TIME - IN_TIME) * 24 * 60)), 0) AS WEEK_WORK FROM WORK WHERE EMP_NO = #{empNo} AND TO_CHAR(IN_TIME, 'YY/MM/DD') BETWEEN TRUNC(SYSDATE,'iw') AND SYSDATE
	</select>
	
	<select id="selectDayWork" resultType="int">
		SELECT NVL(TRUNC((NVL(OUT_TIME, SYSDATE) - IN_TIME) * 24 * 60), 0) AS DAY_WORK FROM WORK WHERE EMP_NO = #{empNo} AND TO_CHAR(IN_TIME, 'YYYY/MM/DD') = TO_CHAR(SYSDATE, 'YYYY/MM/DD')
	</select>
	
</mapper>
