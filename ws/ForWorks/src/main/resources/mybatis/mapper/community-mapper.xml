<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="communityMapper">

	<select id="selectTotalCount" resultType="int">
		SELECT COUNT(CMU_NO)
		FROM COMMUNITY
		WHERE CMU_STATUS='N'
	</select>
	
	<select id="selectDp" resultType="int">
		SELECT COUNT(CMU_NO)
		FROM COMMUNITY
		WHERE CMU_STATUS='N'
		AND CMU_READ = 'MY'
	</select>
	
	<select id="selectList" resultType="com.kh.forworks.community.vo.CommunityVo">
		SELECT
			CMU_NO
			,EMP_NO
			,CMU_TITLE
			,CMU_CONTENT
			,CMU_ENROLL_DATE
			,CMU_MODIFIY_DATE
			,CMU_CNT
			,CMU_READ
			,CMU_STATUS
		FROM COMMUNITY
		WHERE CMU_STATUS = 'N'
		ORDER BY CMU_NO DESC
	</select>
	
	<select id="selectListdp" resultType="com.kh.forworks.community.vo.CommunityVo">
		SELECT
			CMU_NO
			,EMP_NO
			,CMU_TITLE
			,CMU_CONTENT
			,CMU_ENROLL_DATE
			,CMU_MODIFIY_DATE
			,CMU_CNT
			,CMU_READ
			,CMU_STATUS
		FROM COMMUNITY
		WHERE CMU_STATUS = 'N'
		AND CMU_READ = 'MY'
		ORDER BY CMU_NO DESC
	</select>	
	
	<insert id="insertCm">
		INSERT INTO COMMUNITY(CMU_NO, EMP_NO, CMU_TITLE, CMU_CONTENT, CMU_READ)
		VALUES(SEQ_COMMUNITY_CMUNO.NEXTVAL, #{empNo}, #{cmuTitle}, #{cmuContent}, #{cmuRead} )
	</insert>
	
	<insert id="insertCmAt">
		INSERT INTO COMMUNITY_ATTACHMENTS
		(CMAT_NO, CMAT_CHANGE, CMAT_ORIGIN, CMAT_PATH, CMU_NO)
		VALUES
		(SEQ_CMUATTACHMENTS_CMUATNO.NEXTVAL, #{cmatChange}, #{cmatOrigin}, #{cmatPath}, SEQ_COMMUNITY_CMUNO.CURRVAL)
	</insert>
	
	
	<update id="increaseCnt">
		UPDATE COMMUNITY
			SET CMU_CNT = CMU_CNT+1
		WHERE CMU_NO = #{cmuNo}
		AND CMU_STATUS = 'N'	
	</update>
	
	
	<select id="selectOne" resultType="com.kh.forworks.community.vo.CommunityVo">
		SELECT *
		FROM COMMUNITY
		WHERE CMU_STATUS ='N'
		AND CMU_NO = #{no}
	</select>
	
	<select id="checkFile"  resultType="com.kh.forworks.communityattachments.vo.CommunityAttachmentsVo">
		SELECT *
		FROM COMMUNITY_ATTACHMENTS
		WHERE CMU_NO = #{no}
	</select>
	
	<update id="editCm">
		UPDATE COMMUNITY SET
			CMU_TITLE		=	#{cmuTitle}
			,CMU_CONTENT		=	#{cmuContent}	
			,CMU_MODIFIY_DATE	=	SYSDATE
			<!-- ,CMU_READ		=	#{cmuRead} -->
		WHERE CMU_STATUS = 'N'
		AND CMU_NO = #{cmuNo}		
	</update>
	
	<update id="editCmat">
		UPDATE COMMUNITY_ATTACHMENTS SET
			CMAT_CHANGE	= #{cmatChange}
			,CMAT_ORIGIN	= #{cmatOrigin}
			,CMAT_PATH	= #{cmatPath}
			,CMAT_UPLOAD	= SYSDATE
		WHERE CMU_NO = #{cmuNo}		
	</update>
	
	<update id="delete">
		UPDATE COMMUNITY SET
			CMU_STATUS = 'Y'
		WHERE CMU_STATUS = 'N'
		AND CMU_NO = #{no}		
	</update>
		
</mapper>
